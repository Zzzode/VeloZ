{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://veloz.io/schemas/strategy-template.json",
  "title": "VeloZ Strategy Template",
  "description": "Schema for validating YAML strategy template definitions",
  "type": "object",
  "required": ["id", "name", "version", "category", "description", "parameters", "strategy_type"],
  "properties": {
    "id": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9_-]*$",
      "description": "Unique identifier for the strategy template"
    },
    "name": {
      "type": "string",
      "minLength": 1,
      "maxLength": 100,
      "description": "Human-readable strategy name"
    },
    "version": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of the template"
    },
    "category": {
      "type": "string",
      "enum": [
        "market_making",
        "trend_following",
        "mean_reversion",
        "momentum",
        "accumulation",
        "volatility",
        "arbitrage",
        "high_frequency"
      ],
      "description": "Strategy category for classification"
    },
    "difficulty": {
      "type": "string",
      "enum": ["beginner", "intermediate", "advanced"],
      "default": "intermediate",
      "description": "Difficulty level for users"
    },
    "risk_level": {
      "type": "string",
      "enum": ["low", "medium", "high"],
      "default": "medium",
      "description": "Risk level indicator"
    },
    "strategy_type": {
      "type": "string",
      "enum": [
        "grid",
        "dca",
        "mean_reversion",
        "momentum",
        "trend_following",
        "market_making",
        "rsi",
        "macd",
        "bollinger_bands",
        "stochastic",
        "arbitrage",
        "scalping"
      ],
      "description": "Maps to C++ strategy implementation"
    },
    "description": {
      "type": "object",
      "required": ["short", "long"],
      "properties": {
        "short": {
          "type": "string",
          "maxLength": 200,
          "description": "Brief description for cards"
        },
        "long": {
          "type": "string",
          "description": "Detailed description"
        },
        "how_it_works": {
          "type": "string",
          "description": "Step-by-step explanation"
        },
        "when_to_use": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Conditions when strategy is effective"
        },
        "when_not_to_use": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Conditions when strategy should be avoided"
        }
      }
    },
    "parameters": {
      "type": "array",
      "minItems": 1,
      "items": {
        "$ref": "#/$defs/parameter"
      },
      "description": "Strategy parameters"
    },
    "presets": {
      "type": "object",
      "additionalProperties": {
        "$ref": "#/$defs/preset"
      },
      "description": "Pre-configured parameter sets"
    },
    "risks": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Risk warnings for users"
    },
    "supported_symbols": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Supported trading pairs (empty = all)"
    },
    "supported_exchanges": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Supported exchanges (empty = all)"
    },
    "min_capital": {
      "type": "number",
      "minimum": 0,
      "description": "Minimum recommended capital in USD"
    },
    "tags": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Searchable tags"
    },
    "author": {
      "type": "string",
      "description": "Template author"
    },
    "created_at": {
      "type": "string",
      "format": "date",
      "description": "Creation date"
    },
    "updated_at": {
      "type": "string",
      "format": "date",
      "description": "Last update date"
    }
  },
  "$defs": {
    "parameter": {
      "type": "object",
      "required": ["name", "type", "description"],
      "properties": {
        "name": {
          "type": "string",
          "pattern": "^[a-z][a-z0-9_]*$",
          "description": "Parameter identifier"
        },
        "display_name": {
          "type": "string",
          "description": "Human-readable name"
        },
        "type": {
          "type": "string",
          "enum": ["integer", "float", "percentage", "currency", "price", "boolean", "string", "enum"],
          "description": "Parameter data type"
        },
        "description": {
          "type": "string",
          "description": "Parameter explanation"
        },
        "default": {
          "description": "Default value"
        },
        "min": {
          "type": "number",
          "description": "Minimum value (for numeric types)"
        },
        "max": {
          "type": "number",
          "description": "Maximum value (for numeric types)"
        },
        "step": {
          "type": "number",
          "description": "Step increment for UI sliders"
        },
        "unit": {
          "type": "string",
          "description": "Display unit (e.g., '%', 'USD', 'BTC')"
        },
        "required": {
          "type": "boolean",
          "default": true,
          "description": "Whether parameter is required"
        },
        "advanced": {
          "type": "boolean",
          "default": false,
          "description": "Hide in basic mode"
        },
        "enum_values": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["value", "label"],
            "properties": {
              "value": {"type": "string"},
              "label": {"type": "string"},
              "description": {"type": "string"}
            }
          },
          "description": "Options for enum type"
        },
        "validation": {
          "$ref": "#/$defs/validation_rule"
        },
        "depends_on": {
          "type": "object",
          "properties": {
            "parameter": {"type": "string"},
            "condition": {"type": "string"},
            "value": {}
          },
          "description": "Conditional visibility"
        }
      }
    },
    "validation_rule": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["range", "less_than", "greater_than", "regex", "custom"],
          "description": "Validation type"
        },
        "reference": {
          "type": "string",
          "description": "Reference parameter for comparison"
        },
        "pattern": {
          "type": "string",
          "description": "Regex pattern for string validation"
        },
        "message": {
          "type": "string",
          "description": "Error message on validation failure"
        }
      }
    },
    "preset": {
      "type": "object",
      "required": ["name", "values"],
      "properties": {
        "name": {
          "type": "string",
          "description": "Preset display name"
        },
        "description": {
          "type": "string",
          "description": "Preset description"
        },
        "values": {
          "type": "object",
          "additionalProperties": true,
          "description": "Parameter values for this preset"
        }
      }
    }
  }
}
