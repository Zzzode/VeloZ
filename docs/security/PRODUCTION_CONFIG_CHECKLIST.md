# Production Configuration Security Checklist

**Document Version**: 1.2
**Last Updated**: 2026-02-23
**Status**: READY FOR SIGN-OFF
**Prepared by**: Security Specialist (dev-security)
**Infrastructure Review by**: dev-infra

---

## Executive Summary - All Issues Resolved

| Item | Status | Priority | Owner |
|------|--------|----------|-------|
| Vault TLS | **RESOLVED** - `config-production.hcl` | OK | dev-infra |
| Vault HA Storage | **RESOLVED** - Raft backend (3-node) | OK | dev-infra |
| Vault Auto-unseal | **RESOLVED** - AWS KMS configured | OK | dev-infra |
| DB SSL Mode | **RESOLVED** - `VELOZ_DB_SSL_MODE` env var | OK | dev-infra |
| Pod Security | CONFIGURED | OK | - |
| Network Policies | CONFIGURED | OK | - |
| Exchange URLs | **MAINNET** | OK | - |
| Container Security | CONFIGURED | OK | - |
| RBAC/IRSA | CONFIGURED | OK | - |

**All Blocking Issues Resolved** (2026-02-23):
- Vault TLS: Enabled in `infra/vault/config-production.hcl`
- Vault HA Storage: Raft backend configured (3-node cluster)
- Vault Auto-unseal: AWS KMS configured
- DB SSL Mode: Added `VELOZ_DB_SSL_MODE` env var (default: `prefer`, production: `require`)

---

## Overview

This checklist validates all production configuration settings for security and reliability before the VeloZ trading platform goes live. Each item must be verified and signed off before production deployment.

---

## 1. Secrets Management

### 1.1 JWT Configuration

| Item | Requirement | Current Status | Action Required |
|------|-------------|----------------|-----------------|
| JWT Secret Length | Minimum 32 characters | Configurable via `VELOZ_JWT_SECRET` | **VERIFY**: Ensure production secret is 32+ chars |
| JWT Secret Entropy | Cryptographically random | Generated by operator | **VERIFY**: Use `openssl rand -base64 48` or similar |
| Token Expiry | Appropriate for use case | Default: 3600s (1 hour) | **OK**: Reasonable default |
| Refresh Token Expiry | Appropriate for use case | 7 days (604800s) | **OK**: Standard refresh period |
| Algorithm | HMAC-SHA256 | Hardcoded | **OK**: Secure algorithm |

**Verification Command**:
```bash
# Check JWT secret length
echo -n "$VELOZ_JWT_SECRET" | wc -c  # Should be >= 32
```

### 1.2 Admin Password

| Item | Requirement | Current Status | Action Required |
|------|-------------|----------------|-----------------|
| Password Source | Environment variable or Vault | `VELOZ_ADMIN_PASSWORD` | **VERIFY**: Not hardcoded |
| Password Strength | Min 12 chars, mixed case, numbers, symbols | Operator responsibility | **VERIFY**: Enforce policy |
| Default Password | Must be changed | Empty default | **OK**: No default password |

**Verification Command**:
```bash
# Ensure admin password is set and not default
[ -n "$VELOZ_ADMIN_PASSWORD" ] && echo "OK: Password set" || echo "ERROR: Password not set"
```

### 1.3 Exchange API Credentials

| Item | Requirement | Current Status | Action Required |
|------|-------------|----------------|-----------------|
| Binance API Key | From Vault or env | `VELOZ_BINANCE_API_KEY` | **VERIFY**: Using Vault in production |
| Binance API Secret | From Vault or env | `VELOZ_BINANCE_API_SECRET` | **VERIFY**: Using Vault in production |
| Testnet vs Mainnet | Correct environment | **MAINNET** in `values-production.yaml` | **OK**: Verified correct URLs |
| API Key Permissions | Minimum required | Operator responsibility | **VERIFY**: No withdrawal permissions |

**Production URLs**:
```bash
# Mainnet (PRODUCTION)
VELOZ_BINANCE_BASE_URL=https://api.binance.com
VELOZ_BINANCE_TRADE_BASE_URL=https://api.binance.com

# Testnet (TESTING ONLY)
VELOZ_BINANCE_BASE_URL=https://testnet.binance.vision
VELOZ_BINANCE_TRADE_BASE_URL=https://testnet.binance.vision
```

### 1.4 HashiCorp Vault

| Item | Requirement | Current Status | Action Required |
|------|-------------|----------------|-----------------|
| Vault Enabled | `true` for production | `VELOZ_VAULT_ENABLED` | **VERIFY**: Enable in production |
| Auth Method | AppRole for production | `VAULT_AUTH_METHOD` | **VERIFY**: Not using dev token |
| TLS Enabled | Required for production | **RESOLVED** - `config-production.hcl` | **OK**: TLS enabled with certs |
| HA Storage | Raft or Consul | **RESOLVED** - Raft backend (3-node) | **OK**: HA configured |
| Auto-unseal | AWS KMS recommended | **RESOLVED** - AWS KMS configured | **OK**: Auto-unseal enabled |
| Audit Logging | File audit device | Enabled | **OK**: Configured |
| UI Disabled | Recommended for production | Disabled in production config | **OK**: UI disabled |
| Role ID/Secret ID | Properly configured | Environment variables | **VERIFY**: Secure storage |
| Token Renewal | Automatic | Implemented | **OK**: Auto-renewal enabled |

**Current Config Issues** (`infra/vault/config.hcl`):
```hcl
# PROBLEM: TLS disabled - comment says "Enable TLS in production"
tls_disable = "true"  # MUST CHANGE TO "false"

# PROBLEM: File storage - not suitable for HA
storage "file" {
  path = "/vault/data"
}
```

**Required Production Vault Configuration**:
```bash
# Required for production
VELOZ_VAULT_ENABLED=true
VAULT_ADDR=https://vault.internal:8200  # Use HTTPS
VAULT_AUTH_METHOD=approle
VAULT_ROLE_ID=<from-secure-storage>
VAULT_SECRET_ID=<from-secure-storage>
```

**Production config.hcl Requirements**:
- [ ] Enable TLS with valid certificates
- [ ] Configure Raft storage for HA
- [ ] Set up AWS KMS auto-unseal
- [ ] Create separate production config file

---

## 2. Audit Logging

### 2.1 Log Storage

| Item | Requirement | Current Status | Action Required |
|------|-------------|----------------|-----------------|
| Log Directory | Writable, secure permissions | `/var/log/veloz/audit` | **VERIFY**: 750 permissions |
| Archive Directory | Separate from active logs | `/var/log/veloz/audit/archive` | **OK**: Configured |
| Log Format | NDJSON | Implemented | **OK**: Machine-parseable |
| Log Rotation | Size-based | 100MB per file | **OK**: Prevents disk exhaustion |

**Verification Commands**:
```bash
# Check log directory permissions
ls -la /var/log/veloz/audit
# Should show: drwxr-x--- (750) owned by veloz user

# Check disk space
df -h /var/log/veloz
```

### 2.2 Retention Policies

| Log Type | Retention | Archive | Status |
|----------|-----------|---------|--------|
| `auth` | 90 days | Yes | **OK**: Compliance requirement |
| `order` | 365 days | Yes | **OK**: Regulatory requirement |
| `api_key` | 365 days | Yes | **OK**: Security audit trail |
| `error` | 30 days | Yes | **OK**: Debugging period |
| `access` | 14 days | No | **OK**: High volume, short retention |

### 2.3 Audit Events

| Event Type | Logged | Details Captured |
|------------|--------|------------------|
| Login Success | Yes | User ID, IP, timestamp |
| Login Failure | Yes | Username attempted, IP, reason |
| Token Refresh | Yes | User ID, IP |
| Order Placement | Yes | Order details, user, symbol |
| Order Cancellation | Yes | Order ID, user, reason |
| API Key Creation | Yes | Key ID (not secret), user |
| API Key Revocation | Yes | Key ID, user, reason |
| Permission Changes | Yes | User, old/new permissions |

---

## 3. Rate Limiting

### 3.1 Global Rate Limits

| Item | Default | Production Recommendation | Status |
|------|---------|---------------------------|--------|
| Capacity | 100 tokens | 100-500 based on load | **VERIFY**: Appropriate for expected traffic |
| Refill Rate | 10 tokens/sec | 10-50 based on load | **VERIFY**: Appropriate for expected traffic |
| Per-User | Yes | Yes | **OK**: Prevents single user abuse |

**Configuration**:
```bash
VELOZ_RATE_LIMIT_CAPACITY=100
VELOZ_RATE_LIMIT_REFILL=10.0
```

### 3.2 Rate Limit Headers

| Header | Purpose | Status |
|--------|---------|--------|
| `X-RateLimit-Limit` | Total capacity | **OK**: Implemented |
| `X-RateLimit-Remaining` | Remaining tokens | **OK**: Implemented |
| `X-RateLimit-Reset` | Reset timestamp | **OK**: Implemented |
| `Retry-After` | When to retry (429) | **OK**: Implemented |

---

## 4. Security Headers

### 4.1 HTTP Security Headers

| Header | Value | Status |
|--------|-------|--------|
| `X-Content-Type-Options` | `nosniff` | **OK**: Prevents MIME sniffing |
| `X-Frame-Options` | `DENY` | **OK**: Prevents clickjacking |
| `X-XSS-Protection` | `1; mode=block` | **OK**: Legacy XSS protection |
| `Content-Security-Policy` | `default-src 'self'...` | **OK**: Restricts content sources |
| `Strict-Transport-Security` | `max-age=31536000; includeSubDomains` | **VERIFY**: Only over HTTPS |
| `Referrer-Policy` | `strict-origin-when-cross-origin` | **OK**: Privacy protection |
| `Permissions-Policy` | `geolocation=(), microphone=(), camera=()` | **OK**: Feature restrictions |
| `Cache-Control` | `no-store, no-cache, must-revalidate, private` | **OK**: Sensitive data protection |

### 4.2 CORS Configuration

| Item | Development | Production | Action Required |
|------|-------------|------------|-----------------|
| Allowed Origins | `*` (any) | Specific origins only | **CRITICAL**: Configure allowed origins |
| Allow Credentials | `false` | `false` (unless needed) | **OK**: Default secure |
| Allowed Methods | GET, POST, DELETE, OPTIONS | Same | **OK**: Minimal methods |

**Production Configuration**:
```bash
VELOZ_PRODUCTION_MODE=true
VELOZ_CORS_ORIGINS=https://trading.veloz.io,https://admin.veloz.io
```

---

## 5. Network Security

### 5.1 IP Filtering

| Item | Requirement | Current Status | Action Required |
|------|-------------|----------------|-----------------|
| IP Whitelist | Optional | Empty (allow all) | **CONSIDER**: Restrict admin endpoints |
| IP Blacklist | Optional | Empty | **OK**: Can be configured |
| Private IP Access | Configurable | Allowed by default | **VERIFY**: Appropriate for deployment |

**Production Configuration**:
```bash
# Optional: Restrict to known IPs
VELOZ_IP_WHITELIST=10.0.0.0/8,192.168.0.0/16
VELOZ_ALLOW_PRIVATE_IPS=true
```

### 5.2 TLS Configuration

| Item | Requirement | Current Status | Action Required |
|------|-------------|----------------|-----------------|
| TLS Enabled | Required for production | Configurable | **CRITICAL**: Enable TLS |
| Certificate | Valid, not self-signed | Operator provides | **VERIFY**: Valid certificate |
| Private Key | Secure storage | Operator provides | **VERIFY**: Proper permissions |
| Minimum Version | TLSv1.2 | Default | **OK**: Secure default |
| Client Cert (mTLS) | Optional | Disabled | **CONSIDER**: For internal services |

**Production Configuration**:
```bash
VELOZ_TLS_ENABLED=true
VELOZ_TLS_CERT=/etc/veloz/tls/server.crt
VELOZ_TLS_KEY=/etc/veloz/tls/server.key
```

---

## 6. Infrastructure Security

### 6.1 Database (PostgreSQL)

| Item | Requirement | Current Status | Action Required |
|------|-------------|----------------|-----------------|
| Password | Strong, from Vault | Vault dynamic secrets | **OK**: Credential rotation configured |
| Encryption at Rest | Required | `storage_encrypted = true` | **OK**: KMS key configured |
| Network Access | Private subnet only | Security group restricts to EKS | **OK**: Not publicly accessible |
| Multi-AZ | Recommended for HA | Supported | **OK**: Available |
| SSL Mode | `sslmode=require` | **Implicit** (env variable) | **MEDIUM**: Add explicit `?sslmode=require` to DATABASE_URL |
| User Permissions | Minimal required | Operator responsibility | **VERIFY**: No superuser |

**Terraform Config** (`infra/terraform/modules/rds/main.tf`):
- Encryption at rest enabled
- KMS key configured
- Security group restricts to EKS nodes only
- Not publicly accessible
- Credentials stored in Secrets Manager

### 6.2 Container Security

| Item | Requirement | Current Status | Action Required |
|------|-------------|----------------|-----------------|
| Base Image | Minimal, updated | Alpine-based | **OK**: Small attack surface |
| Non-root User | Required | `runAsNonRoot: true`, `runAsUser: 1000` | **OK**: Configured |
| Read-only FS | Recommended | `readOnlyRootFilesystem: true` | **OK**: Configured |
| Privilege Escalation | Disabled | `allowPrivilegeEscalation: false` | **OK**: Configured |
| Capabilities | Drop all | `capabilities: drop ALL` | **OK**: Configured |
| Seccomp Profile | RuntimeDefault | `seccompProfile: RuntimeDefault` | **OK**: Configured |
| Resource Limits | Required | Docker Compose | **VERIFY**: Set appropriate limits |
| Security Scanning | Required | Trivy configured | **OK**: CI/CD integration |

**Kubernetes Pod Security** (`values-production.yaml`):
All security contexts properly configured per best practices.

### 6.3 Kubernetes Network Security

| Item | Requirement | Current Status | Action Required |
|------|-------------|----------------|-----------------|
| Network Policy | Restrict ingress/egress | Configured | **OK**: See details below |
| Ingress Restriction | Limit source namespaces | `ingress-nginx` namespace only | **OK**: Configured |
| Egress Restriction | Limit external access | HTTPS (443) only | **OK**: Configured |
| Private IP Exclusion | Block internal scanning | Private ranges excluded | **OK**: Configured |
| DNS Access | Required for service discovery | Allowed | **OK**: Configured |
| RBAC | Least privilege | Service account with minimal permissions | **OK**: IRSA configured |

**Network Policy** (`templates/networkpolicy.yaml`):
- Ingress restricted to ingress-nginx namespace
- Egress limited to HTTPS (443) for external APIs
- Private IP ranges excluded from egress
- DNS allowed for service discovery

### 6.4 Monitoring Integration

| Item | Requirement | Status | Action Required |
|------|-------------|--------|-----------------|
| PagerDuty Key | For critical alerts | `PAGERDUTY_SERVICE_KEY` | **VERIFY**: Configured |
| Opsgenie Key | For alerts | `OPSGENIE_API_KEY` | **VERIFY**: If using Opsgenie |
| Slack Webhook | For notifications | `SLACK_WEBHOOK_URL` | **VERIFY**: If using Slack |
| Grafana Password | Changed from default | `GRAFANA_PASSWORD` | **CRITICAL**: Change default |

---

## 7. Pre-Launch Verification Checklist

### 7.1 Critical Items (Must Complete)

- [ ] JWT secret is 32+ characters, cryptographically random
- [ ] Admin password is strong and not default
- [ ] Vault is enabled with AppRole authentication
- [ ] TLS is enabled for all external connections
- [ ] CORS origins are explicitly configured (not `*`)
- [ ] Exchange API credentials point to correct environment (mainnet/testnet)
- [ ] Exchange API keys have minimal permissions (no withdrawal)
- [ ] Grafana admin password changed from default
- [ ] PagerDuty/Opsgenie integration tested

### 7.2 Important Items (Should Complete)

- [ ] Rate limits appropriate for expected traffic
- [ ] Audit log directory has correct permissions (750)
- [ ] Log retention policies reviewed
- [ ] IP whitelist configured for admin endpoints
- [ ] Database using TLS connections
- [ ] Container resource limits set
- [ ] Security scan shows no critical vulnerabilities

### 7.3 Recommended Items (Nice to Have)

- [ ] mTLS enabled for internal service communication
- [ ] Read-only filesystem for containers
- [ ] Network policies restricting pod communication
- [ ] Secrets rotation schedule documented

---

## 8. Sign-Off

### Security Review

| Role | Name | Date | Signature |
|------|------|------|-----------|
| Security Lead | _________________ | __________ | __________ |
| DevOps Lead | _________________ | __________ | __________ |
| Engineering Lead | _________________ | __________ | __________ |

### Approval

- [ ] All critical items verified
- [ ] All important items verified or documented exceptions
- [ ] Production deployment approved

**Final Approval**: _________________ Date: __________

---

## Appendix A: Environment Variables Reference

```bash
# === SECRETS ===
VELOZ_JWT_SECRET=<32+ char random string>
VELOZ_ADMIN_PASSWORD=<strong password>
VELOZ_BINANCE_API_KEY=<api key>
VELOZ_BINANCE_API_SECRET=<api secret>

# === VAULT ===
VELOZ_VAULT_ENABLED=true
VAULT_ADDR=https://vault.internal:8200
VAULT_AUTH_METHOD=approle
VAULT_ROLE_ID=<role id>
VAULT_SECRET_ID=<secret id>

# === SECURITY ===
VELOZ_PRODUCTION_MODE=true
VELOZ_CORS_ORIGINS=https://trading.veloz.io
VELOZ_TLS_ENABLED=true
VELOZ_TLS_CERT=/etc/veloz/tls/server.crt
VELOZ_TLS_KEY=/etc/veloz/tls/server.key

# === RATE LIMITING ===
VELOZ_RATE_LIMIT_CAPACITY=100
VELOZ_RATE_LIMIT_REFILL=10.0

# === EXCHANGE ===
VELOZ_BINANCE_BASE_URL=https://api.binance.com
VELOZ_BINANCE_TRADE_BASE_URL=https://api.binance.com

# === DATABASE ===
POSTGRES_PASSWORD=<strong password>

# === MONITORING ===
PAGERDUTY_SERVICE_KEY=<service key>
GRAFANA_PASSWORD=<strong password>
```

---

## Appendix B: Security Contacts

| Role | Contact | Escalation |
|------|---------|------------|
| Security On-Call | security@veloz.io | PagerDuty |
| DevOps On-Call | devops@veloz.io | PagerDuty |
| Security Lead | security-lead@veloz.io | Direct |

---

*This document must be reviewed and updated before each production deployment.*
