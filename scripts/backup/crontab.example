# VeloZ Backup Crontab Configuration
# Copy this file to /etc/cron.d/veloz-backup or add entries to crontab
#
# Environment variables (set in /etc/default/veloz-backup):
#   VELOZ_BACKUP_DIR=/backup
#   VELOZ_S3_BUCKET=s3://veloz-backups
#   VELOZ_PG_HOST=localhost
#   VELOZ_PG_USER=veloz
#   VELOZ_PG_DATABASE=veloz

SHELL=/bin/bash
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
MAILTO=ops@example.com

# WAL backup - every 5 minutes
*/5 * * * * veloz /opt/veloz/scripts/backup/backup_wal.sh >> /var/log/veloz/backup_wal.log 2>&1

# Configuration backup - every 6 hours
0 */6 * * * veloz /opt/veloz/scripts/backup/backup_config.sh >> /var/log/veloz/backup_config.log 2>&1

# PostgreSQL full backup - daily at 2:00 AM
0 2 * * * veloz /opt/veloz/scripts/backup/backup_postgres.sh -t full >> /var/log/veloz/backup_postgres.log 2>&1

# PostgreSQL incremental backup (base backup for PITR) - weekly on Sunday at 3:00 AM
0 3 * * 0 veloz /opt/veloz/scripts/backup/backup_postgres.sh -t incremental >> /var/log/veloz/backup_postgres_base.log 2>&1

# Backup verification - weekly on Monday at 4:00 AM
0 4 * * 1 veloz /opt/veloz/scripts/backup/verify_backup.sh -r /var/log/veloz/backup_verify_$(date +\%Y\%m\%d).txt >> /var/log/veloz/backup_verify.log 2>&1

# Log rotation - daily at midnight
0 0 * * * veloz find /var/log/veloz -name "*.log" -mtime +30 -delete

# Cleanup old backup reports - monthly
0 0 1 * * veloz find /var/log/veloz -name "backup_verify_*.txt" -mtime +90 -delete
